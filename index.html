<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>식물 한살이 탐구 (Wikipedia 전용)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: 'Pretendard', system-ui, sans-serif; }
    @media print {
      .no-print { display: none !important; }
      .print-grid { grid-template-columns: 1fr 1fr; gap: 16px; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50">

  <!-- 상단 헤더 -->
  <header class="bg-white sticky top-0 z-10 border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-3">
      <h1 class="text-xl font-bold text-green-700">식물 한살이 탐구 (Wikipedia)</h1>
      <div class="ml-auto text-xs text-slate-400">© Wikipedia/Wikimedia 자료 사용</div>
    </div>
  </header>

  <!-- 검색창 -->
  <section class="max-w-6xl mx-auto px-4 py-4">
    <div class="bg-white rounded-2xl shadow p-4 flex flex-col md:flex-row gap-3 items-stretch">
      <div class="flex-1 flex gap-2">
        <input id="q" class="w-full rounded-xl border px-4 py-3 focus:ring-2 focus:ring-green-500" placeholder="예: 해바라기, 벚나무 ..." />
        <select id="lang" class="rounded-xl border px-3 py-3">
          <option value="ko" selected>한국어</option>
          <option value="en">English</option>
        </select>
      </div>
      <button id="searchBtn" class="rounded-xl bg-green-600 text-white px-5 py-3 font-semibold">검색</button>
    </div>
    <p class="text-xs text-slate-500 mt-2">※ 한국어 문서가 부족할 경우 영어로 자동 보완 검색</p>
  </section>

  <!-- 본문 -->
  <main class="max-w-6xl mx-auto px-4 pb-16">

    <section id="summary" class="hidden bg-white rounded-2xl shadow overflow-hidden">
      <div class="md:flex">
        <div class="md:w-1/3">
          <img id="thumb" class="w-full h-64 object-cover" alt="대표 이미지" />
        </div>
        <div class="p-6 md:w-2/3">
          <div class="flex items-start gap-2">
            <h2 id="title" class="text-2xl font-bold"></h2>
            <a id="wikiLink" href="#" target="_blank" class="ml-auto text-green-600 text-sm underline">원문 보기</a>
          </div>
          <p id="extract" class="mt-3 text-slate-700 leading-7"></p>
          <div id="meta" class="mt-3 text-xs text-slate-500"></div>
        </div>
      </div>
    </section>

    <section id="sections" class="mt-6 grid lg:grid-cols-3 gap-6 print-grid"></section>

    <section id="growthWrap" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-3">한살이 과정 요약</h3>
      <div id="growthContent" class="bg-white rounded-2xl shadow p-5 text-slate-700 leading-7"></div>
    </section>

    <section id="stageCards" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-3">발아 → 성장 → 개화 → 결실</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center"><div class="text-4xl">🌱</div><p id="stage-germination"></p></div>
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center"><div class="text-4xl">🌿</div><p id="stage-growth"></p></div>
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center"><div class="text-4xl">🌼</div><p id="stage-flowering"></p></div>
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center"><div class="text-4xl">🍎</div><p id="stage-fruiting"></p></div>
      </div>
    </section>

    <section id="detailWrap" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-3">세부 특징</h3>
      <ul id="features" class="list-disc pl-5 text-slate-700 leading-7"></ul>
    </section>

    <section id="galleryWrap" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-3">관련 이미지</h3>
      <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div>
    </section>

    <div id="status" class="mt-8 text-center text-slate-500"></div>
  </main>

  <script>
    const $ = (s)=>document.querySelector(s);

    async function searchTitle(query, lang){
      const url = `https://${lang}.wikipedia.org/w/api.php?action=query&list=search&srsearch=${encodeURIComponent(query)}&format=json&origin=*`;
      const r = await fetch(url); const j = await r.json();
      return j?.query?.search?.[0]?.title || null;
    }
    async function getSummary(title, lang){
      const url = `https://${lang}.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(title)}`;
      const r = await fetch(url); return r.json();
    }
    async function getSections(title, lang){
      const url = `https://${lang}.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(title)}&prop=sections&format=json&origin=*`;
      const r = await fetch(url); const j = await r.json(); return j?.parse?.sections || [];
    }
    async function getSectionHTML(title, index, lang){
      const url = `https://${lang}.wikipedia.org/w/api.php?action=parse&page=${encodeURIComponent(title)}&prop=text&section=${index}&format=json&origin=*`;
      const r = await fetch(url); const j = await r.json(); return j?.parse?.text?.['*'] || '';
    }
    async function getMediaList(title, lang){
      const url = `https://${lang}.wikipedia.org/api/rest_v1/page/media-list/${encodeURIComponent(title)}`;
      const r = await fetch(url); return r.json();
    }

    async function run(query, lang){
      try {
        $('#status').textContent = '검색 중...';
        let title = await searchTitle(query, lang);
        if (!title && lang==='ko'){ title = await searchTitle(query,'en'); lang='en'; }
        if (!title){ $('#status').textContent='검색 결과 없음'; return; }

        const summary = await getSummary(title, lang);
        $('#title').textContent = summary.title;
        $('#extract').textContent = summary.extract;
        $('#thumb').src = summary.thumbnail?.source || '';
        $('#wikiLink').href = summary.content_urls.desktop.page;
        $('#meta').textContent = `언어: ${lang.toUpperCase()}`;

        $('#summary').classList.remove('hidden');

        // Sections
        const secs = await getSections(title, lang);
        const container = $('#sections'); container.innerHTML='';
        for(const s of secs.slice(0,3)){
          const html = await getSectionHTML(title, s.index, lang);
          const div = document.createElement('div');
          div.className='bg-white rounded-2xl shadow p-5';
          div.innerHTML = `<h4>${s.line}</h4><div>${html}</div>`;
          container.appendChild(div);
        }

        // Images
        const media = await getMediaList(title, lang);
        const imgs = media.items.filter(i=>i.type==='image');
        if(imgs.length){ $('#gallery').innerHTML=imgs.slice(0,8).map(i=>`<img src=\"${i.thumbnail?.source}\" class='w-full h-40 object-cover'/>`).join(''); $('#galleryWrap').classList.remove('hidden'); }

        $('#status').textContent='';
      } catch(e){ console.error(e); $('#status').textContent='오류 발생'; }
    }

    $('#searchBtn').addEventListener('click',()=>run($('#q').value.trim()||'해바라기',$('#lang').value));
    window.addEventListener('DOMContentLoaded',()=>run('해바라기','ko'));
  </script>
</body>
</html>
