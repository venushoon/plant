<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ì‹ë¬¼ í•œì‚´ì´ íƒêµ¬ (Wikipedia API)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Pretendard:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Pretendard', system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, sans-serif; }
    @media print {
      .no-print { display: none !important; }
      .print-grid { grid-template-columns: 1fr 1fr; gap: 16px; }
      a::after { content: " (ë§í¬)"; font-size: 10px; }
    }
  </style>
</head>
<body class="min-h-screen bg-slate-50">
  <header class="bg-white sticky top-0 z-10 border-b">
    <div class="max-w-6xl mx-auto px-4 py-4 flex items-center gap-3">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="w-7 h-7 text-green-600">
        <path d="M12 2a7 7 0 00-7 7c0 5 7 13 7 13s7-8 7-13a7 7 0 00-7-7zm0 9.5a2.5 2.5 0 110-5 2.5 2.5 0 010 5z"/>
      </svg>
      <div>
        <h1 class="text-xl font-bold">ì‹ë¬¼ í•œì‚´ì´ íƒêµ¬ (Wikipedia)</h1>
        <p class="text-sm text-slate-500">ê²€ìƒ‰ì–´ë¡œ ì‹ë¬¼ì„ ì…ë ¥í•˜ë©´ ë°œì•„Â·ì„±ì¥Â·ê°œí™”Â·ê²°ì‹¤ ê³¼ì •ê³¼ ì´ë¯¸ì§€ê¹Œì§€ ìë™ ì •ë¦¬</p>
      </div>
      <div class="ml-auto text-xs text-slate-400">Â© ìœ„í‚¤ë°±ê³¼/Wikimedia ìë£Œ ì‚¬ìš© Â· ë¼ì´ì„ ìŠ¤ í‘œì‹œ</div>
    </div>
  </header>

  <section class="max-w-6xl mx-auto px-4 py-4">
    <div class="bg-white rounded-2xl shadow p-4 flex flex-col md:flex-row gap-3 items-stretch md:items-center">
      <div class="flex-1 flex gap-2">
        <input id="q" class="w-full rounded-xl border px-4 py-3 focus:outline-none focus:ring-2 focus:ring-green-500" placeholder="ì˜ˆ: í•´ë°”ë¼ê¸°, ë²šë‚˜ë¬´, ì†Œë‚˜ë¬´ ..." />
        <select id="lang" class="rounded-xl border px-3 py-3">
          <option value="ko" selected>í•œêµ­ì–´(ko)</option>
          <option value="en">English(en)</option>
        </select>
      </div>
      <div class="flex gap-2">
        <button id="searchBtn" class="rounded-xl bg-green-600 text-white px-5 py-3 font-semibold hover:bg-green-700 transition">ê²€ìƒ‰</button>
        <button id="printBtn" class="rounded-xl border px-5 py-3 font-semibold hover:bg-slate-50 transition">ì¸ì‡„/ë°°í¬</button>
      </div>
    </div>
    <p class="text-xs text-slate-500 mt-2">â€» í•œêµ­ì–´ ë¬¸ì„œê°€ ë¶€ì¡±í•  ê²½ìš° ìë™ìœ¼ë¡œ ì˜ì–´ ë¬¸ì„œë¡œ ë³´ì™„ ê²€ìƒ‰í•©ë‹ˆë‹¤.</p>
  </section>

  <main class="max-w-6xl mx-auto px-4 pb-16">
    <section id="summary" class="hidden bg-white rounded-2xl shadow overflow-hidden">
      <div class="md:flex">
        <div class="md:w-1/3">
          <img id="thumb" class="w-full h-64 object-cover" alt="ëŒ€í‘œ ì´ë¯¸ì§€" />
        </div>
        <div class="p-6 md:w-2/3">
          <div class="flex items-start gap-2">
            <h2 id="title" class="text-2xl font-bold"></h2>
            <a id="wikiLink" href="#" target="_blank" class="ml-auto text-green-600 text-sm underline">ì›ë¬¸ ë³´ê¸°</a>
          </div>
          <p id="extract" class="mt-3 text-slate-700 leading-7"></p>
          <div id="meta" class="mt-3 text-xs text-slate-500"></div>
        </div>
      </div>
    </section>

    <section id="sections" class="mt-6 grid lg:grid-cols-3 gap-6 print-grid"></section>

    <section id="growthWrap" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-3">í•œì‚´ì´ ê³¼ì • ìš”ì•½</h3>
      <div id="growthContent" class="bg-white rounded-2xl shadow p-5 text-slate-700 leading-7"></div>
    </section>

    <!-- ë‹¨ê³„ë³„ ì¹´ë“œ -->
    <section id="stageCards" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-3">ë°œì•„ â†’ ì„±ì¥ â†’ ê°œí™” â†’ ê²°ì‹¤</h3>
      <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center">
          <div class="text-4xl">ğŸŒ±</div>
          <div class="mt-2 font-semibold">ë°œì•„</div>
          <p class="text-sm text-slate-600 text-center mt-1">ì”¨ì•—ì—ì„œ ì‹¹ì´ íŠ¸ë©° ë¿Œë¦¬ì™€ ì¤„ê¸°ê°€ ìë¼ê¸° ì‹œì‘</p>
        </div>
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center">
          <div class="text-4xl">ğŸŒ¿</div>
          <div class="mt-2 font-semibold">ì„±ì¥</div>
          <p class="text-sm text-slate-600 text-center mt-1">ìê³¼ ì¤„ê¸°ê°€ ë¬´ì„±í•˜ê²Œ ìë¼ë©° ê´‘í•©ì„±ì„ í™œë°œíˆ í•¨</p>
        </div>
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center">
          <div class="text-4xl">ğŸŒ¸</div>
          <div class="mt-2 font-semibold">ê°œí™”</div>
          <p class="text-sm text-slate-600 text-center mt-1">ê½ƒì´ í”¼ì–´ ìˆ˜ë¶„ê³¼ ìˆ˜ì •ì´ ì´ë£¨ì–´ì§</p>
        </div>
        <div class="bg-white rounded-2xl shadow p-5 flex flex-col items-center">
          <div class="text-4xl">ğŸ</div>
          <div class="mt-2 font-semibold">ê²°ì‹¤</div>
          <p class="text-sm text-slate-600 text-center mt-1">ì—´ë§¤ê°€ ë§ºíˆê³  ì”¨ì•—ì´ í˜•ì„±ë˜ì–´ ë²ˆì‹ ì¤€ë¹„</p>
        </div>
      </div>
    </section>

    <section id="galleryWrap" class="mt-6 hidden">
      <h3 class="text-lg font-semibold mb-3">ê´€ë ¨ ì‚¬ì§„Â·ì´ë¯¸ì§€</h3>
      <div id="gallery" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-3"></div>
      <p class="text-xs text-slate-500 mt-2">ì´ë¯¸ì§€ë¥¼ í´ë¦­í•˜ë©´ ì›ë³¸ê³¼ ë¼ì´ì„ ìŠ¤ ì •ë³´ë¥¼ ë³¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    </section>

    <div id="status" class="mt-8 text-center text-slate-500"></div>
  </main>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const statusEl = $('#status');
    const sectionMapKo = [ 'ë°œì•„','ìƒì¥','ê°œí™”','ìˆ˜ë¶„','ìˆ˜ì •','ê²°ì‹¤','ì”¨ì•—','ì—´ë§¤','ë²ˆì‹','í˜•íƒœ','íŠ¹ì§•' ];
    const sectionMapEn = [ 'Germination','Growth','Flowering','Pollination','Fertilization','Fruit','Seed','Reproduction','Characteristics','Description' ];

    function apiURL(lang, path) { return `https://${lang}.wikipedia.org${path}`; }

    async function searchTitle(query, lang) {
      const url = apiURL(lang, `/w/api.php?action=query&list=search&srnamespace=0&srsearch=${encodeURIComponent(query)}&format=json&origin=*`);
      const r = await fetch(url);
      const j = await r.json();
      return j?.query?.search?.[0]?.title || null;
    }

    async function getSummary(title, lang) {
      const url = apiURL(lang, `/api/rest_v1/page/summary/${encodeURIComponent(title)}`);
      const r = await fetch(url);
      if (!r.ok) throw new Error('ìš”ì•½ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
      return r.json();
    }

    async function getSections(title, lang) {
      const url = apiURL(lang, `/w/api.php?action=parse&page=${encodeURIComponent(title)}&prop=sections&format=json&origin=*`);
      const r = await fetch(url);
      const j = await r.json();
      return j?.parse?.sections || [];
    }

    async function getSectionHTML(title, index, lang) {
      const url = apiURL(lang, `/w/api.php?action=parse&page=${encodeURIComponent(title)}&prop=text&section=${index}&format=json&origin=*`);
      const r = await fetch(url);
      const j = await r.json();
      return j?.parse?.text?.['*'] || '';
    }

    async function getMediaList(title, lang) {
      const url = apiURL(lang, `/api/rest_v1/page/media-list/${encodeURIComponent(title)}`);
      const r = await fetch(url);
      if (!r.ok) return { items: [] };
      return r.json();
    }

    function pickSectionsByLabels(sections, lang) {
      const labels = (lang === 'ko') ? sectionMapKo : sectionMapEn;
      const wanted = [];
      for (const s of sections) {
        const name = s?.line || '';
        if (labels.some(l => name.toLowerCase().includes(l.toLowerCase()))) {
          wanted.push({ index: s.index, name });
        }
      }
      const seen = new Set();
      return wanted.filter(w => { const key = w.name.toLowerCase(); if (seen.has(key)) return false; seen.add(key); return true; }).slice(0, 6);
    }

    function stripRefs(html) {
      return html.replaceAll(/<sup[^>]*class=\"reference\"[\s\S]*?<\/sup>/g, '').replaceAll(/<table[^>]*class=\"infobox[\s\S]*?<\/table>/g, '').replaceAll(/<style[\s\S]*?<\/style>/g, '').replaceAll(/<script[\s\S]*?<\/script>/g, '').replaceAll(/\s\(\s*í¸ì§‘\s*\)/g, '');
    }

    function cardHTML(title, inner) { return `<article class=\"bg-white rounded-2xl shadow p-5\"><h4 class=\"font-semibold mb-2\">${title}</h4><div class=\"prose max-w-none\">${inner}</div></article>`; }

    function imageItemHTML(item) {
      const thumb = item?.thumbnail?.source || item?.srcset?.[0]?.src;
      const src = item?.original?.source || thumb;
      const caption = item?.title || item?.caption?.text || '';
      const credit = item?.artist?.text || item?.credit || '';
      return `<a href=\"${src}\" target=\"_blank\" class=\"group block overflow-hidden rounded-xl border bg-white\"><img src=\"${thumb}\" alt=\"${caption}\" class=\"w-full h-40 object-cover group-hover:scale-105 transition\"/><div class=\"p-2 text-xs text-slate-600"><div class=\"truncate\">${caption || 'ì´ë¯¸ì§€'}</div><div class=\"text-[10px] text-slate-400 truncate\">${credit || ''}</div></div></a>`;
    }

    function setStatus(msg) { statusEl.textContent = msg || ''; }
    function show(el) { el.classList.remove('hidden'); }
    function hide(el) { el.classList.add('hidden'); }

    function generateGrowthInfo(summaryText) {
      let text = summaryText.toLowerCase();
      if (text.includes('ì”¨ì•—') || text.includes('seed')) {
        return "ì´ ì‹ë¬¼ì€ ì”¨ì•—ì—ì„œ ë°œì•„í•˜ì—¬ ìë¼ë©°, ìê³¼ ì¤„ê¸°ê°€ ë°œë‹¬í•œ í›„ ê½ƒì´ í”¼ê³  ì—´ë§¤ë¥¼ ë§ºìŠµë‹ˆë‹¤.";
      } else if (text.includes('í¬ì') || text.includes('spore')) {
        return "ì´ ì‹ë¬¼ì€ í¬ìë¡œ ë²ˆì‹í•˜ì—¬ ë°œì•„ í›„ ì–´ë¦° ê°œì²´ê°€ ìë¼ ì„±ì²´ë¡œ ì„±ì¥í•©ë‹ˆë‹¤.";
      } else {
        return "ì´ ì‹ë¬¼ì˜ ìƒí™œì‚¬ëŠ” ì”¨ì•—ì´ë‚˜ í¬ìì—ì„œ ì‹œì‘í•´ ìë¼ê³  ê½ƒì„ í”¼ìš´ ë’¤ ì—´ë§¤ë¥¼ ë§ºëŠ” ê³¼ì •ì„ ê±°ì¹©ë‹ˆë‹¤.";
      }
    }

    function generateComparison(summaryText) {
      return "ì–´ë¦° ì‹œê¸°ì—ëŠ” ì‘ì€ ìƒˆì‹¹ê³¼ ì—°ì•½í•œ ììœ¼ë¡œ ë‚˜íƒ€ë‚˜ê³ , ì„±ìˆ™í•˜ë©´ ê½ƒê³¼ ì—´ë§¤ë¥¼ ë§ºìœ¼ë©° ë²ˆì‹ì— ê¸°ì—¬í•©ë‹ˆë‹¤.";
    }

    async function run(query, lang) {
      try {
        setStatus('ê²€ìƒ‰ ì¤‘â€¦');
        hide($('#summary')); hide($('#galleryWrap')); hide($('#growthWrap')); hide($('#stageCards'));
        $('#sections').innerHTML = ''; $('#gallery').innerHTML = '';

        let title = await searchTitle(query, lang);
        let usedLang = lang;

        if (!title && lang === 'ko') { usedLang = 'en'; title = await searchTitle(query, 'en'); }
        if (!title) { setStatus('ê²€ìƒ‰ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

        const summary = await getSummary(title, usedLang);
        $('#title').textContent = summary.title || title;
        $('#extract').textContent = summary.extract || '';
        $('#thumb').src = summary.thumbnail?.source || 'https://upload.wikimedia.org/wikipedia/commons/6/65/No-Image-Placeholder.svg';
        $('#wikiLink').href = summary.content_urls?.desktop?.page || apiURL(usedLang, `/wiki/${encodeURIComponent(title)}`);
        $('#meta').textContent = `ì–¸ì–´: ${usedLang.toUpperCase()} Â· ë¬¸ì„œ ID: ${summary.pageid || '-'} Â· ë¶„ë¥˜: ${summary.description || ''}`;
        show($('#summary'));

        const sections = await getSections(summary.title || title, usedLang);
        const picks = pickSectionsByLabels(sections, usedLang);
        const secWrap = $('#sections');
        if (picks.length) {
          for (const p of picks) {
            const html = await getSectionHTML(summary.title || title, p.index, usedLang);
            const clean = stripRefs(html);
            const h = cardHTML(p.name, clean);
            const div = document.createElement('div');
            div.innerHTML = h;
            div.querySelectorAll('a').forEach(a=>a.setAttribute('target','_blank'));
            secWrap.appendChild(div.firstElementChild);
          }
        }

        const growthInfo = generateGrowthInfo(summary.extract || '');
        const comparison = generateComparison(summary.extract || '');
        $('#growthContent').innerHTML = `<p>${growthInfo}</p><p class=\"mt-2\">${comparison}</p>`;
        show($('#growthWrap'));
        show($('#stageCards'));

        const media = await getMediaList(summary.title || title, usedLang);
        const images = (media.items || []).filter(x => x.type === 'image' || x?.type === 'mediainfo');
        if (images.length) {
          $('#gallery').innerHTML = images.slice(0, 16).map(imageItemHTML).join('');
          show($('#galleryWrap'));
        }

        setStatus('');
      } catch (e) {
        console.error(e);
        setStatus('ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ ë¬¸ì œê°€ ë°œìƒí–ˆì–´ìš”.');
      }
    }

    $('#searchBtn').addEventListener('click', () => run($('#q').value.trim() || 'í•´ë°”ë¼ê¸°', $('#lang').value));
    $('#q').addEventListener('keydown', (e) => { if (e.key === 'Enter') $('#searchBtn').click(); });
    $('#printBtn').addEventListener('click', () => window.print());

    window.addEventListener('DOMContentLoaded', () => run('í•´ë°”ë¼ê¸°', 'ko'));
  </script>
</body>
</html>
